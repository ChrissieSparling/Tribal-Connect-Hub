{% extends "layout.html" %}

{% block title %}Welcome — TribalConnect{% endblock %}
{% block content %}
<div class="auth-card" style="max-width:640px;margin:2rem auto;">
  <h1>Welcome to TribalConnect</h1>
  <p class="muted">Choose your tribe to personalize your experience. You can add your Tribal ID now or later.</p>

  {% if message %}
  <p class="muted" style="color:#0a7a0a; margin-top:.75rem;">{{ message }}</p>
  {% endif %}
  {% if error %}
  <p class="muted" style="color:#b00020; margin-top:.75rem;">{{ error }}</p>
  {% endif %}

  {% if current_user %}
  <p style="margin-top:.5rem;">Signed in as <strong>{{ current_user.username }}</strong> ({{ current_user.email }})</p>
  <form action="/onboarding/tribe" method="post" style="margin-top:1rem;" novalidate>
    <label for="tribe_id">Your Tribe</label>
    <select id="tribe_id" name="tribe_id" required>
      <option value="" disabled {% if not current_user or not current_user.tribe_id %}selected{% endif %}>
        Select a tribe
      </option>
      <option value="1" {% if current_user and current_user.tribe_id == 1 %}selected{% endif %}>Snoqualmie Tribe
      </option>
      <option value="2" {% if current_user and current_user.tribe_id == 2 %}selected{% endif %}>Tulalip Tribes</option>
      <option value="3" {% if current_user and current_user.tribe_id == 3 %}selected{% endif %}>Yakama Nation</option>
    </select>

    <label for="tribal_id_number" style="margin-top:.5rem;">Tribal ID # (optional)</label>
    <input id="tribal_id_number" name="tribal_id_number" type="text"
      value="{{ current_user.tribal_id_number if current_user and current_user.tribal_id_number else '' }}"
      placeholder="e.g., 123456" />

    <button type="submit" style="margin-top:.9rem;">Save & Continue</button>
  </form>

  {% if current_user.is_verified %}
  <p class="muted" style="margin-top:1rem;">✅ Membership verified. <a href="/tribal-portal">Enter your Tribal Portal</a>
  </p>
  {% else %}
  <p class="muted" style="margin-top:1rem;">⏳ Membership pending verification by enrollment staff. You can still browse
    public sections.</p>
  {% endif %}

  <form action="/logout" method="post" style="margin-top:1rem;">
    <button type="submit">Log out</button>
  </form>
  {% else %}
  <p class="muted" style="margin-top:1rem;">Please <a href="{{ request.url_for('login_page') }}">log in</a> first.</p>
  {% endif %}
</div>
{% endblock %}