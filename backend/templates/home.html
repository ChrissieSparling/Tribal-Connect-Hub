{%- extends "layout.html" -%}
{% block title %}Home • Tribal Connect Hub{% endblock %}

{% block head %}
<style>
  .hero {
    position: relative; border-radius: 18px; overflow: hidden; min-height: 420px;
    background:
      linear-gradient( to bottom right, rgba(0,0,0,.55), rgba(0,0,0,.35) ),
      url("{{ url_for('static', path='img/tribalconnect-banner.jpg') }}") center/cover no-repeat #0e1a1f;
  }
  .hero__inner { position:absolute; inset:0; display:grid; place-items:center; padding:2rem; text-align:center; }
  .hero h1 { font-weight:800; font-size: clamp(2rem, 5vw, 3.75rem); margin:0 0 .5rem; }
  .hero .lead { font-size: clamp(1rem, 2.5vw, 1.25rem); opacity:.95; }
  .text-gradient { background: linear-gradient(90deg,#f6e27a,#8ef1c7); -webkit-background-clip:text; background-clip:text; color:transparent; }

  .cta-row { display:flex; gap:.75rem; flex-wrap:wrap; justify-content:center; margin-top:1.25rem; }
  .btn-hero { padding:.8rem 1.2rem; border-radius:999px; font-weight:600; }

  .glass {
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.18);
    box-shadow: 0 8px 28px rgba(0,0,0,.25);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    border-radius: 16px;
  }
  .events { margin-top: 1.25rem; }
  .event-item { padding: .9rem 1rem; border-bottom: 1px dashed rgba(255,255,255,.15); }
  .event-item:last-child { border-bottom: 0; }
  .event-title { font-weight:700; text-transform: none; }
  .event-meta { opacity:.85; font-size:.95rem; }
</style>
{% endblock %}

{% block content %}
<div class="py-4">

  <!-- HERO -->
  <section class="hero" role="region" aria-labelledby="hero-title">
    <div class="hero__inner text-light">
      <div class="container">
        <h1 id="hero-title">
          Welcome to <span class="text-gradient">TribalConnect Hub</span>
        </h1>
        <p class="lead">
          Uniting Native Nations through tradition, technology, and sovereign community-building.
        </p>

        <div class="cta-row">
          <a class="btn btn-success btn-hero" href="/tribes-html">
            Explore Tribes&nbsp; ›
          </a>
          <a class="btn btn-outline-light btn-hero" href="/login">Login</a>
          <a class="btn btn-primary btn-hero" href="/signup">Join Community</a>
        </div>

        <!-- Upcoming "glass" card -->
        <div class="container maxw-840 mt-2rem">
          <div class="glass text-light p-3 p-md-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h2 class="h5 m-0">Upcoming Events</h2>
              <a class="link-light text-decoration-underline" href="/tribes-html">View all tribes</a>
            </div>
            <div id="events" class="events small">
              <em class="opacity-75">Loading…</em>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <footer class="text-center text-muted small mt-4">
    © 2025 TribalConnect. All rights reserved. | <a class="link-secondary" href="/contact">Contact Us</a>
  </footer>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Simple upcoming list: pull events for a couple of known tribes (adjust as you grow)
  async function fetchEventsFor(tribeId){
    try {
      const r = await fetch(`/tribes/${tribeId}/events`);
      if (!r.ok) return [];
      return await r.json();
    } catch { return []; }
  }

  function fmtDateRange(s, e){
    try {
      const sd = new Date(s); const ed = e ? new Date(e) : null;
      const opts = { month:'short', day:'numeric', year:'numeric' };
      return ed ? `${sd.toLocaleDateString(undefined,opts)}–${ed.toLocaleDateString(undefined,opts)}`
                : sd.toLocaleDateString(undefined,opts);
    } catch { return s; }
  }

  (async function loadUpcoming(){
    const box = document.getElementById('events');
    const a = await fetchEventsFor(1);   // Snoqualmie (demo)
    const b = await fetchEventsFor(2);   // Tulalip (demo)
    const all = [...a, ...b];

    if (!all.length){
      box.innerHTML = '<em class="opacity-75">No upcoming events yet.</em>';
      return;
    }

    // Sort by start_date ascending if present
    all.sort((x,y) => new Date(x.start_date||x.date) - new Date(y.start_date||y.date));

    box.innerHTML = all.slice(0,4).map(e => `
      <div class="event-item">
        <div class="event-title text-capitalize">${e.title}</div>
        <div class="event-meta">
          ${fmtDateRange(e.start_date || e.date, e.end_date)}
          ${e.location ? ` • ${e.location}` : ''}
          ${e.tribe_id ? '' : ''}
        </div>
      </div>
    `).join('');
  })();
</script>
{% endblock %}
